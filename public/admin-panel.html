<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>店務管理系統</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">   
    <style>
            /* 【新增這一段】響應式 CRM 樣式 */
    @media (max-width: 768px) {
        .details-grid {
            grid-template-columns: 1fr; /* 在手機上，從左右兩欄變成垂直單欄 */
        }
        .profile-summary {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }
    }
        :root {
            --primary-color: #007bff; --secondary-color: #6c757d; --danger-color: #dc3545;
            --success-color: #28a745; --warning-color: #ffc107; --info-color: #17a2b8;
            --light-gray: #f8f9fa; --border-color: #dee2e6;
            --text-dark: #343a40; --text-light: #6c757d;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; background-color: var(--light-gray); }
        .header { background-color: var(--text-dark); color: white; padding: 0.8rem 1.5rem; }
        .header h1 { margin: 0; font-size: 1.4rem; }
        .nav-tabs { background-color: white; padding: 0 1rem; border-bottom: 1px solid var(--border-color); display: flex; flex-wrap: nowrap; overflow-x: auto; }
        .nav-tabs a { padding: 0.8rem; color: var(--text-light); text-decoration: none; font-weight: 500; border-bottom: 3px solid transparent; cursor: pointer; white-space: nowrap; }
        .nav-tabs a.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
        .main-content { padding: 1.5rem; }
        .page { display: none; } .page.active { display: block; }
        .page-header {
            display: flex;                 /* 啟用 Flexbox 佈局 */
            justify-content: space-between; /* 核心：將子元素推向兩端 */
            align-items: center;           /* 讓標題和按鈕垂直置中對齊 */
            margin-bottom: 1.5rem;
        }
        .page-header h2 { margin: 0; font-size: 1.8rem; color: var(--text-dark); }
        
        table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border-radius: 8px; overflow: hidden; }
        th, td { padding: 0.8rem; border-bottom: 1px solid var(--border-color); vertical-align: middle; text-align: center; }
        th { background-color: var(--light-gray); font-weight: 600; font-size: 0.9rem; }
        td { font-size: 0.9rem; }
        
        .compound-cell .main-info { font-weight: bold; }
        .compound-cell .sub-info { font-size: 0.8rem; color: var(--text-light); }
        .action-btn { padding: 0.4rem 0.8rem; font-size: 0.8rem; border: none; border-radius: 5px; cursor: pointer; color: white; }
        .btn-edit { background-color: var(--warning-color); color: #212529; }
        .btn-sync { background-color: var(--info-color); }

        .filter-bar { display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem; align-items: center; }
        .filter-group { display: flex; gap: 0.5rem; }
        .filter-group button { padding: 0.4rem 0.8rem; font-size: 0.8rem; border: 1px solid var(--border-color); background-color: white; border-radius: 5px; cursor: pointer; }
        .filter-group button.active { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }
        
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: flex-start; z-index: 1000; overflow-y: auto; padding-top: 5vh; padding-bottom: 5vh; }
        .modal-content { background: white; padding: 25px; border-radius: 8px; width: 90%; max-width: 600px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-bottom: 20px; }
        .modal-header h3 { margin: 0; }
        .modal-close { font-size: 1.5rem; font-weight: bold; border: none; background: none; cursor: pointer; }
        
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 8px; font-size: 1rem; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .form-actions { margin-top: 20px; text-align: right; }
        .btn-save { background-color: var(--primary-color); }
        .btn-cancel { background-color: var(--secondary-color); }

        /* Dashboard Styles */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; }
        .stat-card { background-color: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .stat-card h3 { margin-top: 0; color: var(--text-light); font-size: 1rem; }
        .stat-card .stat-value { font-size: 2.5rem; font-weight: bold; color: var(--primary-color); }
        .stat-card .stat-subtext { color: var(--text-light); font-size: 0.9rem; margin-top: 5px;}

    /* CRM Modal Styles (優化空間版本) */
        #user-details-modal .modal-content {
            max-width: 800px;
        }
        .details-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 1rem; /* 縮小網格間距 */
        }
        .profile-summary {
            text-align: left;
            word-break: break-all; /* 避免長字串撐開版面 */
        }
        .profile-summary img {
            width: 80px; /* 縮小頭像 */
            height: 80px;
            border-radius: 50%;
            margin-bottom: 0.5rem; /* 縮小頭像下方間距 */
            display: block;
            background-color: #f0f0f0;
            border: 1px solid var(--border-color);
        }
        .profile-summary h4 { margin: 0.2rem 0; }
        .profile-summary p {
            margin: 0.15rem 0; /* 大幅縮小文字行間距 */
            font-size: 0.8rem; /* 稍微縮小字體 */
            color: var(--text-light);
        }
        .profile-summary hr { margin: 0.5rem 0; }

        .details-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 0.5rem; /* 縮小頁籤下方間距 */
        }
        .details-tab {
            padding: 0.5rem 0.8rem; /* 縮小頁籤上下內距 */
            cursor: pointer;
        }
        .details-tab.active {
            border-bottom: 3px solid var(--primary-color);
            font-weight: bold;
        }
        .details-tab-content { display: none; }
        .details-tab-content.active {
            display: block;
            max-height: 220px; /* 設定一個最大高度，內容超長時內部會產生捲軸 */
            overflow-y: auto;
        }
        #user-details-modal table { font-size: 0.8rem; }
        #user-details-modal th, #user-details-modal td { padding: 0.4rem; } /* 縮小表格內距 */

        .message-sender {
            margin-top: 1rem; /* 縮小訊息發送區上方間距 */
            border-top: 1px solid var(--border-color);
            padding-top: 1rem; /* 縮小訊息發送區上方內距 */
        }


        /* 【** 庫存管理頁樣式 **】 */
        .draggable-row { cursor: default; }
        .drag-handle-cell { text-align: left !important; }
        .drag-handle { cursor: move; display: inline-block; width: 20px; font-size: 1.2rem; color: #999; margin-right: 5px; }

        /* 【** 編輯視窗專用 RWD 樣式 **】 */
        #edit-game-modal .modal-content { max-width: 800px; }
        .edit-game-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .grid-span-2 { grid-column: span 2; }
        .sub-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .sub-grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }

        @media (max-width: 768px) {
            .details-grid, .edit-game-grid, .sub-grid, .sub-grid-3 {
                grid-template-columns: 1fr;
            }
            .grid-span-2 { grid-column: span 1; }
            .profile-summary { border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; }
        }
                .modal-content {
            background: white; padding: 25px; border-radius: 8px;
            width: 90%; max-width: 600px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: flex; flex-direction: column;
            max-height: 90vh;
        }

        /* 【** 步驟 1: 讓表單填滿可用空間 **】 */
        /* 我們需要讓 form 元素也成為 flex 容器的一部分 */
        #edit-game-form {
            display: flex;
            flex-direction: column;
            overflow: hidden; /* 確保內容不會溢出 form */
            flex-grow: 1; /* 讓 form 填滿 modal-content 的剩餘空間 */
        }
        
        .modal-body {
            overflow-y: auto; /* 讓內容區塊可以垂直滾動 */
            padding-right: 15px; /* 增加一點右邊距，避免滾動條太貼近內容 */
        }
        
        .modal-header, .form-actions {
            flex-shrink: 0; /* 確保頭部和腳部不會被壓縮 */
        }

        /* 【** 步驟 2: (可選，但建議) 幫按鈕區塊加上分隔線 **】 */
        .form-actions {
            margin-top: 20px;
            text-align: right;
            flex-shrink: 0;
            padding-top: 20px; /* 增加上方間距 */
            border-top: 1px solid var(--border-color); /* 加上分隔線 */
        }

/* --- 行事曆樣式 --- */
.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    background-color: white;
    border-radius: 8px 8px 0 0;
    border: 1px solid var(--border-color);
    border-bottom: none;
}
.calendar-header h3 { margin: 0; font-size: 1.2rem; }
.calendar-header button { background: none; border: 1px solid var(--border-color); border-radius: 50%; width: 30px; height: 30px; cursor: pointer; }

#calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    border: 1px solid var(--border-color);
    background-color: white;
}
.calendar-day, .calendar-weekday {
    border-right: 1px solid var(--border-color);
    border-top: 1px solid var(--border-color);
    padding: 8px;
}
.calendar-day:nth-child(7n) { border-right: none; }
.calendar-weekday {
    font-weight: bold;
    text-align: center;
    background-color: var(--light-gray);
}
.calendar-day {
    min-height: 120px;
    display: flex;
    flex-direction: column;
}
.day-number { font-weight: bold; }
.day-other-month .day-number { color: #ccc; }
.calendar-booking {
    font-size: 0.75rem;
    padding: 3px 5px;
    margin-top: 5px;
    border-radius: 4px;
    background-color: var(--info-color);
    color: white;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
} 

/* --- 【最終修正】彈窗滾動樣式 --- */

/* 1. 讓 modal-content 成為 flex 容器，並限制最大高度 */
#edit-product-modal .modal-content {
    display: flex;
    flex-direction: column;
    max-height: 90vh; /* 最大高度為視窗的 90% */
}

/* 2. 【關鍵】讓 form 填滿 header 以外的剩餘空間，並成為 flex 容器 */
#edit-product-modal #edit-product-form {
    display: flex;
    flex-direction: column;
    flex-grow: 1; /* 延展以填滿可用空間 */
    overflow: hidden; /* 防止內部元素溢出 form */
}

/* 3. 讓 modal-body 在 form 內部延展，並在內容過多時產生滾動條 */
#edit-product-modal .modal-body {
    flex-grow: 1; /* 延展以填滿 form 內的可用空間 */
    overflow-y: auto;  /* 當內容垂直溢出時，顯示滾動條 */
    padding: 0 15px; /* 增加一點左右內距，避免滾動條太貼近內容 */
}

/* 4. 確保頭部和腳部(按鈕區)高度固定，不被壓縮 */
#edit-product-modal .modal-header,
#edit-product-modal .form-actions {
    flex-shrink: 0;
}

/* 5. (美化) 為按鈕區加上分隔線 */
#edit-product-modal .form-actions {
    padding-top: 20px;
    margin-top: 15px;
    border-top: 1px solid var(--border-color);
}

/* --- 【新增】滑動開關 (Toggle Switch) 樣式 --- */
.switch {
    position: relative;
    display: inline-block;
    width: 50px; /* 寬度 */
    height: 28px; /* 高度 */
}

.switch input { 
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    -webkit-transition: .4s;
    transition: .4s;
    border-radius: 28px; /* 圓角 */
}

.slider:before {
    position: absolute;
    content: "";
    height: 20px; /* 圓點高度 */
    width: 20px;  /* 圓點寬度 */
    left: 4px;
    bottom: 4px;
    background-color: white;
    -webkit-transition: .4s;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .slider {
    background-color: var(--success-color); /* 開啟時的顏色 */
}

input:focus + .slider {
    box-shadow: 0 0 1px var(--success-color);
}

input:checked + .slider:before {
    -webkit-transform: translateX(22px); /* 圓點移動距離 */
    -ms-transform: translateX(22px);
    transform: translateX(22px);
}

/* public/admin-panel.html */

/* --- 【新增】批次操作工具列樣式 --- */
.batch-actions-toolbar {
    display: none; /* 預設隱藏 */
    position: sticky;
    bottom: 80px; /* 顯示在 Tab Bar 上方 */
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 30px); /* 寬度比螢幕稍窄 */
    max-width: 600px;
    background-color: var(--text-dark);
    color: white;
    padding: 10px 15px;
    border-radius: 8px;
    box-shadow: 0 -4px 15px rgba(0,0,0,0.2);
    z-index: 99;
    align-items: center;
    justify-content: space-between;
    gap: 15px;
}

.batch-actions-toolbar.visible {
    display: flex; /* 當加上 visible class 時顯示 */
}

#batch-selected-count {
    font-weight: bold;
}

    </style>

</head>


<body>

    <div id="admin-panel" style="display: none;">
        <header class="header">
            <h1>店務管理系統</h1>
        </header>
        <nav class="nav-tabs">
            <a href="#dashboard" class="active">儀表板</a>
            <a href="#users">顧客管理</a>
            <a href="#inventory">產品/服務管理</a>
            <a href="#bookings">訂位管理</a>
            <a href="#exp-history">點數紀錄</a>
            <a href="#news">資訊管理</a>
            <a href="#drafts">訊息草稿</a>
            <a href="#store-info">店家資訊</a>
            <a href="#settings">系統設定</a>
            <a href="#points">點數發放</a>
        </nav>

        <main class="main-content">
            <div id="page-settings" class="page">
                <div class="page-header">
                    <h2>系統設定</h2>
                </div>
                <form id="settings-form">
                    <div id="settings-container">
                        <p>正在載入設定...</p>
                    </div>
                    <div class="form-actions" style="margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                        <button type="submit" class="action-btn btn-save">儲存所有變更</button>
                    </div>
                </form>
            </div>

            <div id="page-scan" class="page">
            </div>
        </main>        

<main class="main-content">
    
<div id="page-dashboard" class="page active">
    <div class="page-header">
        <h2>今日狀態總覽</h2>
    </div>
    
    <div id="dashboard-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1.5rem;">
        <div class="stat-card" data-target="bookings">
            <h3>今日預約總人數</h3>
            <p id="stat-today-guests" class="stat-value">讀取中...</p>
        </div>
        <div class="stat-card" data-target="bookings">
            <h3>今日新預約數</h3>
            <p id="stat-today-new-bookings" class="stat-value">讀取中...</p>
        </div>
        <div class="stat-card" data-target="bookings">
            <h3>本週預約數</h3>
            <p id="stat-this-week-bookings" class="stat-value">讀取中...</p>
        </div>
        <div class="stat-card" data-target="users">
            <h3>新註冊會員</h3>
            <p id="stat-today-new-users" class="stat-value">讀取中...</p>
        </div>
    </div>
    <div style="margin-top: 40px; padding: 20px; border: 1px solid var(--danger-color); border-radius: 8px; background-color: #fff2f2;">
        <h4 style="color: var(--danger-color); margin-top: 0;">危險操作區</h4>
        <p>此按鈕將會清空所有預約、租借、消費紀錄等展示資料，讓系統恢復初始狀態。此操作無法復原。</p>
        <button id="reset-demo-data-btn" class="action-btn" style="background-color: var(--danger-color);">清空所有展示資料</button>
    </div>
</div>

            <div id="page-users" class="page">
                <div class="page-header">
                    <h2>顧客總表</h2>
                    <button id="sync-d1-to-sheet-btn" class="action-btn" style="background-color: var(--success-color);">同步至 Google Sheet</button>
                </div>
                <input type="text" id="user-search-input" placeholder="依 LINE 名稱或暱稱搜尋..." style="width: 100%; box-sizing: border-box; padding: 8px; margin-bottom: 1rem;">
                <table>
                    <thead>
                        <tr><th>LINE 名稱 / 暱稱</th><th>會員方案</th><th>會員等級 / 點數</th><th>方案優惠</th><th>標籤</th><th>操作</th></tr>
                    </thead>
                    <tbody id="user-list-tbody"></tbody>
                </table>
            </div>

<div id="page-inventory" class="page">
            <div class="page-header">
                <h2>產品/服務管理</h2>     
                <div class="filter-group">                          
                <button id="download-csv-template-btn" class="action-btn" style="background-color: var(--info-color); margin-right: 10px;">下載 CSV 模板</button>
                <label for="csv-upload-input" class="action-btn" style="background-color: #17a2b8; margin-right: 10px;">從 CSV 匯入</label>
                <input type="file" id="csv-upload-input" accept=".csv" style="display: none;">
                <button id="add-product-btn" style="background-color: #17a2b8;" class="action-btn btn-save">新增單筆產品</button>
                </div>
            </div>
            <div class="filter-bar">
                <input type="text" id="product-search-input" placeholder="依名稱搜尋..." style="flex-grow: 1; padding: 8px;">
                <div id="inventory-stock-filter" class="filter-group">
                    <button class="active" data-filter="all">全部庫存</button>
                    <button data-filter="in_stock">有庫存</button>
                    <button data-filter="out_of_stock">無庫存</button>
                </div>
                <div id="inventory-visibility-filter" class="filter-group">
                    <button class="active" data-filter="all">全部狀態</button>
                    <button data-filter="visible">已上架</button>
                    <button data-filter="hidden">未上架</button>
                </div>
            </div>
    <div id="batch-actions-toolbar" class="batch-actions-toolbar">
        <span id="batch-selected-count">已選取 0 項</span>
        <div class="filter-group"> <button id="batch-publish-btn" class="action-btn" style="background-color: var(--success-color);">上架</button>
            <button id="batch-unpublish-btn" class="action-btn" style="background-color: var(--secondary-color);">下架</button>
            <button id="batch-delete-btn" class="action-btn" style="background-color: var(--danger-color);">刪除選取項目</button>
        </div>
    </div>

            <table>
                <thead>
                    <tr>
                        <th style="width: 40px;"><input type="checkbox" id="select-all-products"></th>
                        <th style="width: 50px;">順序</th>
                        <th>產品/服務 (ID / 分類)</th>
                        <th>庫存</th>
                        <th>售價</th>
                        <th style="width: 80px;">上架</th>
                        <th style="width: 80px;">操作</th>
                    </tr>
                </thead>
                <tbody id="product-list-tbody"></tbody>
            </table>
        </div>


<div id="page-bookings" class="page">
    <div class="page-header">
        <h2>訂位管理</h2>
        <div>
            <button id="switch-to-calendar-view-btn" class="action-btn" style="background-color: var(--info-color); margin-right: 10px;">切換至行事曆</button>
            <button id="create-booking-btn" class="action-btn btn-save" style="background-color: #17a2b8; margin-right: 10px;">手動建立預約</button>
            <button id="full-sync-bookings-btn" class="action-btn" style="background-color: #17a2b8; margin-right: 10px;">手動同步至 Sheet</button>
            <button id="manage-booking-dates-btn" class="action-btn" style="background-color: #ffc107; color: #000;">管理公休日</button>
        </div>
    </div>

    <div id="calendar-view-container" style="display: none;">
        <div class="calendar-header">
            <button id="calendar-prev-month-btn">&lt;</button>
            <h3 id="calendar-month-year"></h3>
            <button id="calendar-next-month-btn">&gt;</button>
        </div>
        <div id="calendar-grid"></div>
    </div>

    <div id="list-view-container">
        <div class="filter-bar">
            <div id="booking-status-filter" class="filter-group">
                <button class="active" data-filter="today">今日預約</button>
                <button data-filter="confirmed">未來預約</button>
                <button data-filter="checked-in">已報到</button>
                <button data-filter="cancelled">已取消</button>
            </div>
        </div>
        <table>
            <thead>
                <tr><th>時間</th><th>客戶</th><th>人數</th><th>狀態</th><th>操作</th></tr>
            </thead>
            <tbody id="booking-list-tbody"></tbody>
        </table>
    </div>
</div>

        <div id="page-exp-history" class="page">
            <div class="page-header">
                <h2>點數紀錄查詢</h2>
            </div>
            <div class="filter-bar">
                <input type="search" id="exp-user-filter-input" placeholder="依使用者名稱或 LINE ID 搜尋..." style="width: 100%; box-sizing: border-box; padding: 8px;">
            </div>
            <table>
                <thead>
                    <tr>
                        <th>使用者</th>
                        <th>日期</th>
                        <th>原因</th>
                        <th>點數</th>
                    </tr>
                </thead>
                <tbody id="exp-history-tbody"></tbody>
            </table>
        </div>
        <div id="page-news" class="page">
            <div class="page-header">
                <h2>情報管理</h2>
                <button id="add-news-btn" class="action-btn btn-save">新增情報</button>
            </div>
            <table>
                <thead>
                    <tr><th>標題</th><th>分類</th><th>發布日期</th><th>狀態</th><th>操作</th></tr>
                </thead>
                <tbody id="news-list-tbody"></tbody>
            </table>
        </div>
        <div id="page-drafts" class="page">
            <div class="page-header">
                <h2>訊息草稿管理</h2>
                <button id="add-draft-btn" class="action-btn btn-save">新增草稿</button>
            </div>
            <table>
                <thead>
                    <tr><th>標題</th><th>內容預覽</th><th>操作</th></tr>
                </thead>
                <tbody id="draft-list-tbody"></tbody>
            </table>
        </div>


        <div id="page-store-info" class="page">
            <div class="page-header"><h2>店家資訊管理</h2></div>
            <form id="store-info-form">
                <div class="form-group"><label for="info-address">地址</label><input type="text" id="info-address" required></div>
                <div class="form-group"><label for="info-phone">電話</label><input type="text" id="info-phone" required></div>
                <div class="form-group"><label for="info-hours">營業時間 (換行請直接按 Enter)</label><textarea id="info-hours" rows="5" required></textarea></div>
                <div class="form-group"><label for="info-desc">店家介紹</label><textarea id="info-desc" rows="8" required></textarea></div>
                <div class="form-actions"><button type="submit" class="action-btn btn-save">儲存變更</button></div>
            </form>
        </div>

            <div id="page-points" class="page">
                <div class="page-header"><h2>點數發放中心</h2></div>
                <div id="points-user-selection">
                    <div class="form-group">
                        <label for="user-search-input-points">搜尋顧客 (LINE 名稱 / 暱稱 / ID)</label>
                        <input type="text" id="user-search-input-points" placeholder="請輸入至少1個字元...">
                        <ul id="user-search-results"></ul>
                    </div>
                    <div class="points-actions">
                         <button id="start-scan-btn" class="action-btn" style="background-color: var(--info-color);">啟動相機掃碼</button>
                    </div>
                    <div id="qr-reader" style="width: 100%; max-width: 500px; margin: 20px auto 0; display: none;"></div>
                </div>
                <hr style="margin: 2rem 0;">
                <div id="points-entry-form" style="display: none;">
                    <div class="form-group">
                        <label>目標顧客</label>
                        <div id="selected-user-display">請先從上方搜尋或掃碼選取顧客</div>
                    </div>
                    <div class="form-group">
                        <label for="reason-select">點數名稱 (原因):</label>
                        <select id="reason-select">
                            <option value="消費回饋">消費回饋</option>
                            <option value="活動獎勵">活動獎勵</option>
                            <option value="會員優惠">會員優惠</option>
                            <option value="other">其他 (請手動輸入)</option>
                        </select>
                        <input type="text" id="custom-reason-input" placeholder="請輸入自訂原因" style="display: none; margin-top: 10px;">
                    </div>
                    <div class="form-group">
                        <label for="exp-input">點數:</label>
                        <input type="number" id="exp-input" placeholder="請輸入要發放的點數" min="1">
                    </div>
                    <button id="submit-exp-btn" class="action-btn btn-save" style="width: 100%; padding: 12px; font-size: 1rem;">確認發放</button>
                    <p id="points-status-message" style="text-align: center; min-height: 1.2em; margin-top: 10px;"></p>
                </div>
            </div>
    
<div id="booking-settings-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3>管理可預約日 (可複選)</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div id="booking-datepicker-admin-container"></div>
        <div class="form-actions">
            <button type="button" id="open-month-btn" class="action-btn" style="background-color: var(--info-color); float: left;">開啟本月所有日期</button>
            <button type="button" class="action-btn btn-cancel">取消</button>
            <button type="button" id="save-booking-settings-btn" class="action-btn btn-save">儲存變更</button>
        </div>
    </div>
</div>

<div id="user-details-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="user-details-title">顧客資料</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div id="user-details-content">
                </div>
        </div>
    </div>

    
        <div id="edit-user-modal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modal-user-title">編輯使用者</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="edit-user-form">
                    <input type="hidden" id="edit-user-id">
                    <div class="form-group">
                        <label for="edit-level-input">等級</label>
                        <input type="number" id="edit-level-input" min="1" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-exp-input">消費累積點數</label>
                        <input type="number" id="edit-exp-input" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-class-select">會員方案</label>
                        <select id="edit-class-select"></select>
                        <input type="text" id="edit-class-other-input" placeholder="請輸入自訂方案名稱" style="display: none; margin-top: 10px;">
                    </div>
                    <div class="form-group">
                        <label for="edit-perk-input">方案優惠</label>
                        <input type="text" id="edit-perk-input" placeholder="選擇方案後將自動帶入">
                    </div>
                    <div class="form-group">
                        <label for="edit-tag-select">標籤</label>
                        <select id="edit-tag-select">
                            <option value="">無</option>
                            <option value="會員">會員</option>
                            <option value="員工">員工</option>
                            <option value="黑名單">黑名單</option>
                            <option value="other">其他 (自訂)</option>
                        </select>
                        <input type="text" id="edit-tag-other-input" placeholder="請輸入自訂標籤" style="display: none; margin-top: 10px;">
                    </div>
                    <div class="form-group">
                        <label for="edit-notes-textarea">備註</label>
                        <textarea id="edit-notes-textarea" rows="4" placeholder="記錄客人的特殊事項..."></textarea>
                    </div>                
                    <div class="form-actions">
                        <button type="button" class="action-btn btn-cancel">取消</button>
                        <button type="submit" class="action-btn btn-save">儲存</button>
                    </div>
                </form>
            </div>
        </div>
    


    <div id="edit-news-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header"><h3 id="modal-news-title">新增情報</h3><button class="modal-close">&times;</button></div>
            <form id="edit-news-form">
                <input type="hidden" id="edit-news-id">
                <div class="form-group"><label for="edit-news-title">標題</label><input type="text" id="edit-news-title" required></div>
                <div class="form-group"><label for="edit-news-category">分類</label><input type="text" id="edit-news-category" placeholder="例如：促銷活動" required></div>
                <div class="form-group"><label for="edit-news-date">發布日期</label><input type="text" id="edit-news-date" required></div>
                <div class="form-group"><label for="edit-news-image">圖片網址</label><input type="url" id="edit-news-image" placeholder="https://..."></div>
                <div class="form-group"><label for="edit-news-content">詳細內文 (選填)</label><textarea id="edit-news-content" rows="8"></textarea></div>
                <div class="form-group"><label style="display: flex; align-items: center;"><input type="checkbox" id="edit-news-published" checked style="width: auto; margin-right: 10px;">立即發布</label></div>
                <div class="form-actions">
                    <button type="button" class="action-btn btn-cancel">取消</button>
                    <button type="submit" class="action-btn btn-save">儲存</button>
                    <button type="button" id="delete-news-btn" class="action-btn" style="display: none; background-color: #dc3545;">刪除</button>
                </div>
            </form>
        </div>
    </div>

 
       <div id="cancel-booking-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>取消預約並發送通知</h3>
                <button class="modal-close">&times;</button>
            </div>
            <p>您正準備取消 <strong id="cancel-booking-info"></strong> 的預約。</p>
            <div class="message-sender">
                <div class="form-group">
                    <label for="cancel-message-draft-select">選擇通知訊息草稿 (選填)</label>
                    <select id="cancel-message-draft-select"><option value="">-- 不發送通知或手動輸入 --</option></select>
                </div>
                <div class="form-group">
                    <label for="cancel-direct-message-content">訊息內容</label>
                    <textarea id="cancel-direct-message-content" rows="4" placeholder="若留空，則只取消預約，不發送通知。"></textarea>
                </div>
                <div class="form-actions">
                    <button id="confirm-cancel-booking-btn" class="action-btn btn-save">確認取消</button>
                </div>
            </div>
        </div>
    </div> 

<div id="edit-product-modal" class="modal-overlay">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h3 id="modal-product-title">編輯產品/服務</h3>
            <button class="modal-close">&times;</button>
        </div>
        <form id="edit-product-form">
            <div class="modal-body">
                <input type="hidden" id="edit-product-id">
                <div class="edit-product-grid">
                    <div class="form-group">
                        <label for="edit-product-name">產品/服務名稱</label>
                        <input type="text" id="edit-product-name" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-product-id-display">產品 ID (不可修改)</label>
                        <input type="text" id="edit-product-id-display" readonly style="background: #e9ecef;">
                    </div>
                    <div class="sub-grid">
                        <div class="form-group">
                            <label for="edit-product-category">分類</label>
                            <input type="text" id="edit-product-category" placeholder="例如: 課程, 餐飲, 服務">
                        </div>
                        <div class="form-group">
                            <label for="edit-product-tags">標籤 (以逗號分隔)</label>
                            <input type="text" id="edit-product-tags" placeholder="例如: 入門, 攝影, VIP限定">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>圖片網址 (最多5張)</label>
                        <div class="edit-product-image-inputs">
                            <div class="form-group"><label for="edit-product-image-1"></label><input type="url" id="edit-product-image-1" placeholder="1. 請貼上圖片網址"></div>
                            <div class="form-group"><label for="edit-product-image-2"></label><input type="url" id="edit-product-image-2" placeholder="2. 請貼上圖片網址"></div>
                            <div class="form-group"><label for="edit-product-image-3"></label><input type="url" id="edit-product-image-3" placeholder="3. 請貼上圖片網址"></div>
                            <div class="form-group"><label for="edit-product-image-4"></label><input type="url" id="edit-product-image-4" placeholder="4. 請貼上圖片網址"></div>
                            <div class="form-group"><label for="edit-product-image-5"></label><input type="url" id="edit-product-image-5" placeholder="5. 請貼上圖片網址"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="edit-product-description">詳細介紹</label>
                        <textarea id="edit-product-description" rows="5"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="edit-product-inventory-type">庫存管理模式</label>
                        <select id="edit-product-inventory-type">
                            <option value="none">無庫存管理</option>
                            <option value="quantity">依數量管理</option>
                            <option value="status">依狀態管理</option>
                        </select>
                    </div>
                    <div id="stock-quantity-group" class="form-group" style="display: none;">
                        <label for="edit-product-stock-quantity">庫存數量</label>
                        <input type="number" id="edit-product-stock-quantity" min="0">
                    </div>
                    <div id="stock-status-group" class="form-group" style="display: none;">
                        <label for="edit-product-stock-status">庫存狀態</label>
                        <input type="text" id="edit-product-stock-status" placeholder="例如: 可預約, 已售罄">
                    </div>
                    <div class="form-group">
                        <label for="edit-product-price">價格</label>
                        <input type="number" id="edit-product-price" min="0">
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; margin-top: 10px;">
                            <input type="checkbox" id="edit-product-is-visible" style="width: auto; margin-right: 10px;">
                            是否上架 (顯示於 LIFF)
                        </label>
                    </div>
                    <div class="form-group grid-span-2">
                        <hr>
                        <label>彈性通用規格 (選填，最多5組)</label>
                        <div class="sub-grid" style="margin-bottom: 10px;">
                            <input type="text" id="edit-spec-1-name" placeholder="規格1名稱 (例: 課程時長)">
                            <input type="text" id="edit-spec-1-value" placeholder="規格1內容 (例: 2小時)">
                        </div>
                        <div class="sub-grid" style="margin-bottom: 10px;">
                            <input type="text" id="edit-spec-2-name" placeholder="規格2名稱 (例: 適合對象)">
                            <input type="text" id="edit-spec-2-value" placeholder="規格2內容 (例: 初學者)">
                        </div>
                        <div class="sub-grid" style="margin-bottom: 10px;">
                            <input type="text" id="edit-spec-3-name" placeholder="規格3名稱">
                            <input type="text" id="edit-spec-3-value" placeholder="規格3內容">
                        </div>
                        <div class="sub-grid" style="margin-bottom: 10px;">
                            <input type="text" id="edit-spec-4-name" placeholder="規格4名稱">
                            <input type="text" id="edit-spec-4-value" placeholder="規格4內容">
                        </div>
                        <div class="sub-grid">
                            <input type="text" id="edit-spec-5-name" placeholder="規格5名稱">
                            <input type="text" id="edit-spec-5-value" placeholder="規格5內容">
                        </div>
                    </div>
                </div>
            </div> <div class="form-actions">
                <button type="button" class="action-btn btn-cancel">取消</button>
                <button type="submit" class="action-btn btn-save">儲存變更</button>
            </div>
        </form> </div>
</div>

    
    <div id="edit-draft-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-draft-title">編輯訊息草稿</h3>
                <button class="modal-close">&times;</button>
            </div>
            <form id="edit-draft-form">
                <input type="hidden" id="edit-draft-id">
                <div class="form-group">
                    <label for="edit-draft-title">草稿標題</label>
                    <input type="text" id="edit-draft-title" required placeholder="方便您辨識的標題，不會傳送給顧客">
                </div>
                <div class="form-group">
                    <label for="edit-draft-content">訊息內容</label>
                    <textarea id="edit-draft-content" rows="6" required placeholder="這是將會傳送給顧客的實際內容"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="action-btn btn-cancel">取消</button>
                    <button type="submit" class="action-btn btn-save">儲存草稿</button>
                </div>
            </form>
        </div>
    </div>


<div id="create-booking-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3>手動建立預約</h3>
            <button class="modal-close">&times;</button>
        </div>
        <form id="create-booking-form">
            <div class="form-group">
                <label for="booking-user-search">搜尋預約會員 (姓名/暱稱/ID)</label>
                <input type="text" id="booking-user-search" placeholder="輸入關鍵字搜尋...">
                <select id="booking-user-select" style="margin-top: 10px; display: none;"></select>
            </div>
            <hr style="border-color: var(--border-color); margin: 20px 0;">
            <div class="sub-grid">
                <div class="form-group">
                    <label for="booking-date-input">預約日期</label>
                    <input type="text" id="booking-date-input" required>
                </div>
                <div class="form-group">
                    <label for="booking-slot-select">預約時段</label>
                    <select id="booking-slot-select" required></select>
                </div>
            </div>
            <div class="sub-grid">
                <div class="form-group">
                    <label for="booking-name-input">聯絡姓名</label>
                    <input type="text" id="booking-name-input" required>
                </div>
                 <div class="form-group">
                    <label for="booking-phone-input">聯絡電話</label>
                    <input type="tel" id="booking-phone-input" required>
                </div>
            </div>
             <div class="sub-grid">
                <div class="form-group">
                    <label for="booking-people-input">人數</label>
                    <input type="number" id="booking-people-input" value="1" min="1" required>
                </div>
                <div class="form-group">
                    <label for="booking-item-input">預約項目 (選填)</label>
                    <input type="text" id="booking-item-input">
                </div>
            </div>
            <div class="form-actions">
                <button type="button" class="action-btn btn-cancel">取消</button>
                <button type="submit" class="action-btn btn-save">確認建立</button>
            </div>
        </form>
    </div>
</div>

    <script src="https://unpkg.com/html5-qrcode/html5-qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script type="module" src="/admin/app.js"></script>
</body>
</html>